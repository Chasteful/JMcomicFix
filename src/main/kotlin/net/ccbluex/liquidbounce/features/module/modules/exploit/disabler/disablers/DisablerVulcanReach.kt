package net.ccbluex.liquidbounce.features.module.modules.exploit.disabler.disablers

import net.ccbluex.liquidbounce.config.types.nesting.ToggleableConfigurable
import net.ccbluex.liquidbounce.event.events.PacketEvent
import net.ccbluex.liquidbounce.event.events.WorldChangeEvent
import net.ccbluex.liquidbounce.event.handler
import net.ccbluex.liquidbounce.features.module.modules.exploit.disabler.ModuleDisabler
import net.minecraft.network.packet.Packet
import net.minecraft.network.packet.c2s.play.*
import java.util.*

internal object DisablerVulcanReach : ToggleableConfigurable(ModuleDisabler, "VulcanReach4.5", false) {

    private val packetQueue = LinkedList<Packet<*>>()

    @Suppress("unused")
    private val packetHandler = handler<PacketEvent> { event ->
        if (player.age % 2 == 0) {
            if (event.packet is PlayerInteractBlockC2SPacket ||
                event.packet is PlayerMoveC2SPacket ||
                event.packet is HandSwingC2SPacket ||
                event.packet is ClientCommandC2SPacket ||
                event.packet is PlayerInteractEntityC2SPacket
            ) {
                event.cancelEvent()
                packetQueue.add(event.packet)
            }
            return@handler
        }

        if (packetQueue.isNotEmpty()) {
            packetQueue.forEach { network.sendPacket(it) }
            packetQueue.clear()
        }
    }

    @Suppress("unused")
    private val worldChangeHandler = handler<WorldChangeEvent> {
        packetQueue.clear()
    }
}
